<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pokemon Go Tools</title>
    <link href="./css/tom-select.bootstrap5.min.css" rel="stylesheet" />
    <link href="./css/bootstrap.min.css" rel="stylesheet" />
    <link href="./css/pokemon_types.css" rel="stylesheet" />
    <style>
        body {
            padding: 10px;
            margin: 0 auto;
            max-width: 1000px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        img {
            height: 20px;
            padding-right: 2px;
        }

        .stat-div {
            line-height: 1em;
            margin: 10 auto;
            max-width: 500px;
        }

        .stat {
            max-width: 80%;
            margin: 0 auto 16px;
        }

        .iv-div {
            margin-top: 10px;
        }

        .iv-number {
            font-family: Consolas, 'Courier New', Courier, monospace;
            background: rgba(255, 255, 255, 1);
        }

        .stat-bar {
            display: flex;
            background: rgba(0, 0, 0, .08);
            border-radius: 9px;
            margin: 2px 0px;
        }

        .stat-bar .bar:first-child {
            border-left: none;
            border-top-left-radius: 9px;
            border-bottom-left-radius: 9px;
        }

        .stat-bar .bar.active {
            background: #ee9219;
        }

        .stat-bar .bar.end {
            border-top-right-radius: 9px;
            border-bottom-right-radius: 9px;
        }

        .stat-bar .bar {
            height: 18px;
            flex: 1 1 40px;
            border-right: 1px solid rgba(255, 255, 255, .3);
        }

        div {
            margin: 0;
            padding: 0;
            border: 0;
        }

        .stat-bar .bar:nth-child(5n+1) {
            border-left: 4px solid #fff
        }

        .iv-group {
            margin: 2px 5px;
            background-color: #eee;
            border: 1px solid #888;
            border-radius: 2px;
            display: inline-block;
            padding: 2px 5px;
            width: 100px;
            text-align: center;
        }

        .iv3 {
            color: #d97b00;
        }

        .iv3 .iv-group {
            background-color: #ffe2bb;
            border-color: #965000;
        }

        .iv2 {
            color: #209902;
        }

        .iv2 .iv-group {
            background-color: #bdffb0;
            border-color: #005e10;
        }

        .iv1 {
            color: #0050b8;
        }

        .iv1 .iv-group {
            background-color: #b0e2ff;
            border-color: #0a3669;
        }

        .roundSpan {
            text-align: center;
            border-radius: 20px;
            color: white;
            padding: 2px 5px;
            display: inline-block;
            font-size: 14px;
            margin: 2px;
        }

        .inline {
            display: inline-block;
        }

        .inline-input {
            padding: 2px;
            margin: 2px 5px;
        }

        .inline label {
            padding-left: 3px;
        }
    </style>
    <script type="text/javascript" src="./pokemon_go/pokemon-base.js"></script>
    <script type="text/javascript" src="./pokemon_go/pokemon-names.js"></script>
    <script type="text/javascript" src="./pokemon_go/moves.js"></script>
    <script type="text/javascript" src="./js/tom-select.base.min.js"></script>
</head>

<body>
    <h2>IV Appraisal Stats Chart</h2>
    <div>
        <div class="mb-3 row align-items-center">
            <label for="staticEmail" class="col-sm-6 col-form-label">List all IV stats above this percentage:</label>
            <div class="col-sm-5">
                <input id="ivValue" type="number" class="form-control" value="90" min="0" max="100"
                    onkeyup="updateIVChart()" />
            </div>
            <div class="col-sm-1">%</div>
        </div>
    </div>
    <input type="button" class="btn btn-outline-primary" value="Show" onclick="updateIVChart()" />
    <input type="button" class="btn btn-outline-primary" value="Clear" onclick="clearIVValue()" />
    <div class="stat-div"> </div>

    <hr>

    <h2>Find IV stats from CP</h2>
    <div>
        <div class="mb-3 row align-items-center">
            <label for="staticEmail" class="col-sm-2 col-form-label">Pokemon:</label>
            <div class="col-sm-10">
                <select id="pokemon-name" onchange="findIVFromCP()"></select>
            </div>
        </div>
        <div class="mb-3 row align-items-center">
            <label for="staticEmail" class="col-sm-2 col-form-label">CP:</label>
            <div class="col-sm-10">
                <input id="cpValue" type="number" class="form-control" value="" min="10" max="99999"
                    onkeyup="findIVFromCP()" />
            </div>
        </div>
    </div>
    <input type="button" class="btn btn-outline-primary" value="Show" onclick="findIVFromCP()" />
    <input type="button" class="btn btn-outline-primary" value="Clear" onclick="clearIVFromCP()" />
    <div id="CP-IV-div"></div>

    <hr>

    <h2>Move List</h2>
    <h5>Pokemon Types</h5>
    <form id="move-pokemon-filters"> </form>
    <h5>Move Types</h5>
    <form id="move-type-filters"> </form>
    <form>
        <div class="inline inline-input">
            <input type="checkbox" id="show-top-100" name="show-top-100" checked>
            <label for="show-top-100">Show Top 100</label>
        </div>
    </form>
    <div>
        Exclude these pokemons:
        <textarea id="exclude-pokemons" class="form-control">
        </textarea>
    </div>
    <input type="button" class="btn btn-outline-primary" value="Show" onclick="showMoveList()" />
    <input type="button" class="btn btn-outline-primary" value="Clear" onclick="clearMoveList()" />
    <div id="MoveList-div"></div>

    <script>
        // https://pokemon.gameinfo.io/en/js/pokemon-base.js?v=451d06
        // https://pokemon.gameinfo.io/en/js/pokemon-names.js?v=451d06
        // https://pokemon.gameinfo.io/en/js/movesets.js?v=451d06

        const moveOptions = [
            "Non-Legendary", "Released-Only"
        ];

        function convertToCheckBox(value, type, addImage, checked) {
            value2 = type + "-" + value;
            return "<div class='inline inline-input'><input type=\"checkbox\" id=\"move-"
                + value2 + "\" name=\"move-"
                + value2 + "\"" + (checked == true ? "checked" : "")
                + "><label for=\"move-"
                + value2 + "\">"
                + (addImage ? "<img src='./pokemon_go/type_" + value.toLowerCase() + ".png' />" : "")
                + value + "</label></div>";
        }

        function generateMoveOptions() {
            var str = "";
            for (var value of moveOptions) {
                str += convertToCheckBox(value, "pokemon", false, true)
            }
            for (var value of Dict.raw_types) {
                str += convertToCheckBox(value, "pokemon", true)
            }
            document.querySelector("#move-pokemon-filters").innerHTML = str;

            var str = "";
            for (var value of Dict.raw_types) {
                str += convertToCheckBox(value, "type", true)
            }
            document.querySelector("#move-type-filters").innerHTML = str;
        }

        function clearIVValue() {
            document.querySelector(".stat-div").innerHTML = "";
        }

        var pre_percentage = 0;
        function updateIVChart() {
            var percentage = document.querySelector("#ivValue").value;
            var percentage = parseInt(percentage);
            if (percentage == pre_percentage) {
                return;
            }
            pre_percentage = percentage;
            var filtered = {};
            for (var i = 1; i <= 15; i++) {
                for (var j = 1; j <= 15; j++) {
                    for (var k = 1; k <= 15; k++) {
                        if (Math.round((i + j + k) / 45 * 100) >= percentage) {
                            var newA = new Int32Array([i, j, k]);
                            newA.sort();
                            var key = newA.join(",");
                            if (!(key in filtered)) {
                                filtered[key] = newA;
                            }
                        }
                    }
                }
            }
            console.log(filtered);

            var result = "";
            for (const [key, value] of Object.entries(filtered)) {
                var str = "<div class='iv-div'>";
                var sum = value.reduce((partialSum, a) => partialSum + a, 0);
                str += "<h4>" + Math.round(sum * 100 / 45) + "</h4>";
                for (i of value) {
                    str += "<div class='stat-bar'>";
                    for (var j = 1; j < i; j++) {
                        str += "<div class='bar active hover'></div>";
                    }
                    str += "<div class='bar active hover end'></div>";
                    for (var j = i; j < 15; j++) {
                        str += "<div class='bar'></div>";
                    }
                    str += "<div class='iv-number'>" + (i < 10 ? ("0" + i) : i) + "</div>";
                    str += "</div>"
                }
                str += "</div>"
                result += str;
            }

            var div = document.querySelector(".stat-div");
            div.innerHTML = result;
        }

        // calculate IV

        var processedPokemon = []
        for (var h in pokemon_data) {
            for (var v in pokemon_data[h]) {
                var m = 0 == v ? pokemon_names[h] : pokemon_forms[v];
                processedPokemon.push({
                    code: h + "," + v,
                    label: m[0],
                    icon: m[2]
                })
            }
        }

        function calculateIVFromCP(code, cp) {
            console.log(code, cp)
            if (null !== code) {
                this.old = !1;
                var e = code.split(",");
                var t = e[0], n = e[1], r = pokemon_data[t][n][0];
                var filtered = {};
                for (var sta_i = 0; sta_i <= 15; sta_i++)
                    for (var att_i = 0; att_i <= 15; att_i++)
                        for (var def_i = 0; def_i <= 15; def_i++)
                            for (var o = [+sta_i, +att_i, +def_i], i = 2; i <= 80; i++) {
                                var s = getCPM(i);
                                var c = getCp(s, r, o);
                                var l = getHp(s, r, o);
                                if (c === cp) {
                                    var arr = new Int32Array([sta_i, att_i, def_i]);
                                    arr.sort();
                                    var key = arr.join(",");
                                    if (!(key in filtered)) {
                                        filtered[key] = arr;
                                    }
                                }
                            }
                console.log(filtered);
                if (81 == i && filtered.length == 0) {
                    return "A Pokemon with those stats couldn't be found.";
                }
                return filtered;
            } else
                return "You must select a Pokémon!";
        }

        function getCP(e, t, n) {
            var r = getCPM(e);
            return getCp(r, t, n)
        }

        function maxCP(e) {
            return getCP(2 * this.target_level, e || this.stats, this.ivs)
        }

        function maxPerfectCP(e) {
            return getCP(2 * this.target_level, e || this.stats, [15, 15, 15])
        }

        function getCPM(e) {
            var t = [.094, .16639787, .21573247, .25572005, .29024988, .3210876, .34921268, .37523559, .39956728, .4225, .44310755, .46279839, .48168495, .49985844, .51739395, .53435433, .55079269, .56675452, .58227891, .5974, .61215729, .62656713, .64065295, .65443563, .667934, .68116492, .69414365, .70688421, .71939909, .7317, .73776948, .74378943, .74976104, .75568551, .76156384, .76739717, .7731865, .77893275, .784637, .7903];
            return e > 80 && (e = 80),
                e < 2 && (e = 2),
                e % 2 ? Math.pow((Math.pow(t[(e - 1) / 2 - 1], 2) + Math.pow(t[(e - 1) / 2], 2)) / 2, .5) : t[e / 2 - 1]
        }

        function getCp(e, t, n) {
            return Math.max(10, Math.floor(.1 * Math.pow((t[0] + n[0]) * e, .5) * (t[1] + n[1]) * e * Math.pow((t[2] + n[2]) * e, .5)))
        }

        function getHp(e, t, n) {
            return Math.max(10, Math.floor((t[0] + n[0]) * e))
        }

        function findIVFromCP() {
            var pn = document.querySelector("#pokemon-name");
            var d_code = pn.options[pn.selectedIndex].getAttribute("data-code");
            var cp = document.querySelector("#cpValue").value;
            cp = parseInt(cp);
            var result = calculateIVFromCP(d_code, cp);
            var r_div = document.querySelector("#CP-IV-div");
            if (typeof result === 'string' || result instanceof String) {
                console.log(result);
                r_div.innerHTML = result;
            }
            else {
                var str = ""
                var grouped = {};
                for (const [key, value] of Object.entries(result)) {
                    var sum = value.reduce((x, a) => x + a, 0);
                    var percen = Math.round(sum * 100 / 45);
                    if (!(percen in grouped)) {
                        grouped[percen] = [value]
                    }
                    else {
                        grouped[percen].push(value);
                    }
                }

                var str_a = [];
                for (const [key, value] of Object.entries(grouped)) {
                    var cls = "iv1";
                    if (key >= 66) {
                        cls = "iv2";
                    }
                    if (key >= 80) {
                        cls = "iv3";
                    }
                    str = "<div class='row " + cls + " align-items-center'><div class='col-sm-1 col-form-label'>" + key + ":</div>";
                    str += "<div class='col-sm-11'>" + value.map(x => "<div class='iv-group'>" + x.join(", ") + "</div>").join("") + "</div>";
                    str += "</div>";
                    str_a.push(str)
                }
                str = "<div class='row align-items-center'><div class='col-sm-1 col-form-label'><strong>IV %</strong></div>"
                    + "<div class='col-sm-11'><strong>IV Stats</strong></div>"
                    + "</div>"
                    + "</div>";
                str_a.push(str);
                str_a.reverse();
                r_div.innerHTML = str_a.join("");
            }
        }

        function clearIVFromCP() {
            var pn = document.querySelector("#CP-IV-div");
            pn.innerHTML = "";
        }

        function loadPokemonNames() {
            var s = "";
            for (const value of processedPokemon) {
                var name = value.label;
                s += "<option value='" + name + "' data-code='" + value.code + "'>" + name + "</option>";
            }
            document.querySelector("#pokemon-name").innerHTML = s;
        }

        // Move sets:

        var imagesConvert = {
            201: 11,
            386: 11,
            412: 11,
            413: 11,
            421: 11,
            422: 11,
            423: 11,
            479: 11,
            487: 11,
            492: 11,
            550: 11,
            555: 11,
            585: 11,
            586: 11,
            641: 11,
            642: 11,
            645: 11,
            646: 11,
            647: 11,
            648: 11,
            649: 11,
            865: 31,
            866: 31,
            867: 31
        }
        
        var allMoveSet = [];
        var newAllMoves = {};
        var moves_Pokemon_List = {};
        var newPokemon = {};
        var data_cp_multiplier = {};
        var dps_table = {};

        function toTitleCase(str) {
            return str.replace(
                /\w\S*/g,
                function (txt) {
                    return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
                }
            );
        }

        function findMove(str) {
            for (var m1 of newAllMoves) {
                if (m1["name"] == str || m1["name"] + "_" + m1["type_move"] == str) {
                    return m1;
                    break;
                }
            }
        }

        function calculateStatsBettle(base, iv, level, addition) {
            let result = (base + iv) * data_cp_multiplier.find(item => item.level === level).multiplier
            if (addition) return Math.floor(result * addition)
            return Math.floor(result)
        }

        function calculateStatsByTag(baseStats, tag) {
            let checkNerf = tag.toLowerCase().indexOf("mega") >= 0 ? false : true;
            const atk = calBaseATK(baseStats, checkNerf);
            const def = calBaseDEF(baseStats, checkNerf);
            const sta = tag !== "shedinja" ? calBaseSTA(baseStats, checkNerf) : 1;
            return {
                atk: atk,
                def: def,
                sta: sta,
            };
        }

        function calBaseATK(stats, nerf) {
            const atk = stats.atk !== undefined ? stats.atk : stats.find(item => item.stat.name === "attack").base_stat;
            const spa = stats.spa !== undefined ? stats.spa : stats.find(item => item.stat.name === "special-attack").base_stat;

            const lower = Math.min(atk, spa);
            const higher = Math.max(atk, spa);

            const speed = stats.spe !== undefined ? stats.spe : stats.find(item => item.stat.name === "speed").base_stat;

            const scaleATK = Math.round(2 * ((7 / 8) * higher + (1 / 8) * lower));
            const speedMod = 1 + (speed - 75) / 500;
            const baseATK = Math.round(scaleATK * speedMod);
            if (!nerf) return baseATK;
            if (calculateCP(baseATK + 15, calBaseDEF(stats, false) + 15, calBaseSTA(stats, false) + 15, 40) >= 4000) return Math.round(scaleATK * speedMod * 0.91);
            else return baseATK;
        }

        function calBaseDEF(stats, nerf) {
            const def = stats.def !== undefined ? stats.def : stats.find(item => item.stat.name === "defense").base_stat;
            const spd = stats.spd !== undefined ? stats.spd : stats.find(item => item.stat.name === "special-defense").base_stat;

            const lower = Math.min(def, spd);
            const higher = Math.max(def, spd);

            const speed = stats.spe !== undefined ? stats.spe : stats.find(item => item.stat.name === "speed").base_stat;

            const scaleDEF = Math.round(2 * ((5 / 8) * higher + (3 / 8) * lower));
            const speedMod = 1 + (speed - 75) / 500;
            const baseDEF = Math.round(scaleDEF * speedMod);
            if (!nerf) return baseDEF;
            if (calculateCP(calBaseATK(stats, false) + 15, baseDEF + 15, calBaseSTA(stats, false) + 15, 40) >= 4000) return Math.round(scaleDEF * speedMod * 0.91);
            else return baseDEF;
        }

        function calBaseSTA(stats, nerf) {
            const hp = stats.hp !== undefined ? stats.hp : stats.find(item => item.stat.name === "hp").base_stat;

            const baseSTA = Math.floor(hp * 1.75 + 50);
            if (!nerf) return baseSTA;
            if (calculateCP(calBaseATK(stats, false) + 15, calBaseDEF(stats, false) + 15, baseSTA + 15, 40) >= 4000) return Math.round((hp * 1.75 + 50) * 0.91);
            else return baseSTA;
        }

        Object.defineProperty(Array.prototype, "find", {
            value: function find(cond) {
                for (var i of this) {
                    if (cond(i)) {
                        return i;
                    }
                }
            },
            writable: true,
            configurable: true,
        });

        Object.defineProperty(Array.prototype, "includes", {
            value: function includes(text) {
                for (var i of this) {
                    if (i == text) {
                        return true;
                    }
                }
                return false;
            },
            writable: true,
            configurable: true,
        });

        Object.defineProperty(Array.prototype, "includesAny", {
            value: function includesAny(arr) {
                for (var i of this) {
                    for (var j of arr) {
                        if (i == j) {
                            return true;
                        }
                    }
                }
                return false;
            },
            writable: true,
            configurable: true,
        });

        function calculateCP(atk, def, sta, level) {
            return Math.floor(Math.max(10, (atk * (def ** 0.5) * (sta ** 0.5) * data_cp_multiplier.find(item => item.level === level).multiplier ** 2) / 10))
        }

        const options = {
            delay: null,
            specific: false,
            ELITE_MOVE: true,
            POKEMON_SHADOW: true,
            WEATHER_BOOSTS: false,
            POKEMON_FRIEND_LEVEL: 0,
            POKEMON_DEF_OBJ: 160,
            DAMAGE_MULTIPLY: 0.5,
            DAMAGE_CONST: 1,
            IV_ATK: 15,
            IV_DEF: 15,
            IV_HP: 15,
            POKEMON_LEVEL: 40
        };

        function convertMoveToText(t) {
            return toTitleCase(t.replace("_FAST", "").replace(/_/g, " "));
        }

        // generate dps_table.json
        function convertToDpsTable() {
            var processed = {};
            allMoveSet = {};
            for (var value of moves_Pokemon_List) {
                var quickMoves = value["QUICK_MOVES"].concat(value["ELITE_QUICK_MOVES"]);
                var chargeMoves = value["CINEMATIC_MOVES"].concat(value["SHADOW_MOVES"], value["PURIFIED_MOVES"], value["ELITE_CINEMATIC_MOVES"])
                var allMoves = [];
                var pokm = pokemon_names[value["ID"]][5];
                var pokm_key = "";
                var newName = value["NAME"].replace(/_/g, "").replace("FEMALE", "F").replace("MALE", "M");
                for (const [key, vp] of Object.entries(newPokemon)) {
                    if (key.toUpperCase() == newName) {
                        pokm = vp;
                        pokm_key = key;
                    }
                }
                for (var v1 of quickMoves) {
                    for (var v2 of chargeMoves) {
                        var m1 = findMove(v1);
                        var m2 = findMove(v2);

                        var types = [];

                        let stats = calculateStatsByTag(pokm.baseStats, pokm.slug);
                        var atk_2 = calculateStatsBettle(stats.atk, options.IV_ATK, options.POKEMON_LEVEL);
                        var def_2 = calculateStatsBettle(stats.def, options.IV_DEF, options.POKEMON_LEVEL);
                        var sta_2 = calculateStatsBettle(stats.sta, options.IV_HP, options.POKEMON_LEVEL);
                        var dps = calculateAvgDPS(m1, m2, atk_2, def_2, sta_2,
                            getBarCharge(true, Math.abs(m2.pve_energy)), pokm.types, undefined, false);
                        var tdo = calculateTDO(def_2, sta_2, dps, false)
                        allMoves.push([convertMoveToText(v1), m1.type.toLowerCase(), convertMoveToText(v2), m2.type.toLowerCase(), dps, tdo, dps ** 3 * tdo])
                    }
                }
                var p = {
                    "all_moves": allMoves,
                    "id": value["ID"],
                    "name": pokm.name
                }
                allMoveSet[pokm_key] = p;
            }
            console.log(JSON.stringify(allMoveSet), null, 4);
        }

        function numberWithCommas(x, round) {
            var parts = (Math.round(x * 10 ** round) / 10 ** round).toString().split(".");
            parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            return parts.join(".");
        }

        function showMoveList() {
            var enabledOptions = []
            for (var value of moveOptions) {
                var id = "#move-" + "pokemon-" + value;
                var opt = document.querySelector(id).checked;
                if (opt) {
                    enabledOptions.push(value);
                }
            }
            var filterTypes = false;
            for (var value of Dict.types) {
                var id = "#move-" + "pokemon-" + value;
                var opt = document.querySelector(id).checked;
                if (opt) {
                    filterTypes = true;
                    enabledOptions.push(value);
                }
            }
            var allMovesArray = [];
            var includeLegendary = enabledOptions.includes("Non-Legendary");
            var includeReleasedOnly = enabledOptions.includes("Released-Only");
            var capitalOptions = enabledOptions.map(x => toTitleCase(x));
            var excludepokemons = document.querySelector("#exclude-pokemons").innerHTML.toLowerCase();
            var showTop100 = document.querySelector("#show-top-100").checked;

            var enabledMoveTypes = []
            for (var value of Dict.types) {
                var id = "#move-" + "type-" + value;
                var opt = document.querySelector(id).checked;
                if (opt) {
                    enabledMoveTypes.push(value.toLowerCase());
                }
            }
            var filterMoveTypes = enabledMoveTypes.length > 0;
            var maxMoves = {};
            console.log(includeLegendary, includeReleasedOnly, filterTypes, filterMoveTypes, enabledOptions, enabledMoveTypes)
            for (var [key, value] of Object.entries(dps_table)) {
                var maxNum = Math.max(...value.all_moves.map(e => e[6]));
                maxMoves[key] = maxNum;
                for (var v2 of value.all_moves) {
                    var pok = newPokemon[key];
                    if (includeLegendary && pok.pokemonClass == "LEGENDARY") {
                        continue;
                    }
                    else if (includeReleasedOnly && !pok.releasedGO) {
                        continue;
                    }
                    else if (pok.forme != null) {
                        continue;
                    }
                    else if (filterTypes && !pok.types.includesAny(capitalOptions)) {
                        continue;
                    }
                    else if (excludepokemons.includes(dps_table[key].name.toLowerCase())) {
                        continue;
                    }
                    else if (filterMoveTypes
                        && !enabledMoveTypes.includes(v2[1])
                        && !enabledMoveTypes.includes(v2[3])) {
                        continue;
                    }
                    allMovesArray.push([value.id, key, v2[0], v2[1], v2[2], v2[3], v2[4], v2[5], v2[6]])
                }
            }

            allMovesArray = allMovesArray.sort(function (e, t) {
                return t[8] - e[8] // DPS^3*TDO
            });

            var group = {};
            var pre_value = -1;
            var counter = 0;
            for (var value of allMovesArray) {
                if (pre_value != value[0]) {
                    counter++;
                    group[counter] = [value]
                    pre_value = value[0];
                }
                else {
                    group[counter].push(value);
                }
                if (showTop100 && counter >= 100) {
                    break;
                }
            }

            var str = "<table class='table table-striped align-middle'><thead><tr><th></th><th>Pokemon</th><th>Fast Move</th><th>Charge Move</th><th>DPS</th><th>TDO</th><th>DPS^3*TDO</th></tr></thead><tbody>";
            counter = 0;
            console.log(maxMoves)
            for (const [key, value] of Object.entries(group)) {
                var id = dps_table[value[0][1]].id;
                var pok = newPokemon[value[0][1]];
                counter++;
                var maxM = maxMoves[value[0][1]];
                var vm = "<tr><td rowspan='" + value.length + "'>" + counter
                    + "</td><td rowspan='" + value.length + "'><img src='https://raw.githubusercontent.com/PokeMiners/pogo_assets/master/Images/Pokemon/pokemon_icon_"
                    + String(id).padStart(3, '0') + "_" + ((id in imagesConvert) ? String(imagesConvert[id]) : "00")
                    + ".png' /><span class='inline'>"
                    + dps_table[value[0][1]].name + "</span>"
                    + pok.types.map(x => "<span class='inline roundSpan type-" + x + "'>" + x + "</span>").join("") + "</td>";
                vm += value.map(x =>
                    "<td><img src='./pokemon_go/type_" + x[3] + ".png' />" + x[2] + "</td><td><img src='./pokemon_go/type_" + x[5] + ".png' />"
                    + x[4] + "</td><td>"
                    + numberWithCommas(x[6], 2) + "</td><td>"
                    + numberWithCommas(x[7], 2) + "</td><td>"
                    + numberWithCommas(x[8], 2) + "<span>" + (maxM <= x[8] ? "&#9733;" : "") + "</span>" + "</td>").join("</tr><tr>") + "</tr>";
                str += vm;
            }
            str += "</tbody></table>";
            document.querySelector("#MoveList-div").innerHTML = str;

            return;
        }

        function clearMoveList() {
            document.querySelector("#MoveList-div").innerHTML = "";
        }

        const DEFAULT_POKEMON_DEF_OBJ = 160;
        const DEFAULT_POKEMON_SHADOW = false;
        const DEFAULT_WEATHER_BOOSTS = false;
        const DEFAULT_POKEMON_FRIEND_LEVEL = 0;

        const DEFAULT_ENERYGY_PER_HP_LOST = 0.5;
        const DEFAULT_DAMAGE_MULTIPLY = 0.5;
        const DEFAULT_DAMAGE_CONST = 1;

        const MIN_LEVEL = 1;
        const MAX_LEVEL = 51;

        const MIN_IV = 0
        const MAX_IV = 15

        function getBarCharge(isRaid, energy) {
            if (isRaid) {
                const bar = Math.ceil(100 / Math.abs(energy))
                return bar > 3 ? 3 : bar;
            }
            else return Math.abs(energy) > 50 ? 1 : 2;
        }

        function capitalize(string) {
            return string.charAt(0).toUpperCase() + string.slice(1);
        }

        function getMultiFriendshipMulti(level) {
            let dmg = 1;
            if (level === 1) dmg += 0.03;
            else if (level === 2) dmg += 0.05;
            else if (level === 3) dmg += 0.07;
            else if (level === 4) dmg += 0.1;
            return dmg;
        }

        function calculateAvgDPS(fmove, cmove, Atk, Def, HP, bar, typePoke, options, shadow) {
            const FPow = fmove.pve_power;
            const CPow = cmove.pve_power;
            const FE = Math.abs(fmove.pve_energy);
            const CE = Math.abs(cmove.pve_energy);
            const FDur = fmove.durationMs / 1000;
            const CDur = cmove.durationMs / 1000;
            const CDWS = cmove.damageWindowStartMs / 1000;

            const FMulti = (typePoke.includes(toTitleCase(fmove.type)) ? 1.2 : 1) * fmove.accuracyChance
            const CMulti = (typePoke.includes(toTitleCase(cmove.type)) ? 1.2 : 1) * cmove.accuracyChance

            let y, FDmg, CDmg, FDmgBase, CDmgBase
            if (options === undefined) {
                FDmgBase = DEFAULT_DAMAGE_MULTIPLY * FPow * FMulti * (DEFAULT_POKEMON_SHADOW ? 1.2 : 1) * (DEFAULT_WEATHER_BOOSTS ? 1.2 : 1) * getMultiFriendshipMulti(DEFAULT_POKEMON_FRIEND_LEVEL)
                CDmgBase = DEFAULT_DAMAGE_MULTIPLY * CPow * CMulti * (DEFAULT_POKEMON_SHADOW ? 1.2 : 1) * (DEFAULT_WEATHER_BOOSTS ? 1.2 : 1) * getMultiFriendshipMulti(DEFAULT_POKEMON_FRIEND_LEVEL)

                FDmg = Math.floor(FDmgBase * Atk / DEFAULT_POKEMON_DEF_OBJ) + DEFAULT_DAMAGE_CONST
                CDmg = Math.floor(CDmgBase * Atk / DEFAULT_POKEMON_DEF_OBJ) + DEFAULT_DAMAGE_CONST

                y = 900 / (Def * (DEFAULT_POKEMON_SHADOW ? 0.83333331 : 1));
            } else {
                FDmgBase = options.DAMAGE_MULTIPLY * FPow * FMulti * (shadow ? 1.2 : 1) * (typeof options.WEATHER_BOOSTS === "string" ? weatherMultiple(options.WEATHER_BOOSTS, fmove.type) : options.WEATHER_BOOSTS ? 1.2 : 1) * getMultiFriendshipMulti(options.POKEMON_FRIEND_LEVEL)
                CDmgBase = options.DAMAGE_MULTIPLY * CPow * CMulti * (shadow ? 1.2 : 1) * (typeof options.WEATHER_BOOSTS === "string" ? weatherMultiple(options.WEATHER_BOOSTS, cmove.type) : options.WEATHER_BOOSTS ? 1.2 : 1) * getMultiFriendshipMulti(options.POKEMON_FRIEND_LEVEL)

                FDmg = Math.floor(FDmgBase * Atk / options.POKEMON_DEF_OBJ) + options.DAMAGE_CONST
                CDmg = Math.floor(CDmgBase * Atk / options.POKEMON_DEF_OBJ) + options.DAMAGE_CONST

                y = 900 / (Def * (shadow ? 0.83333331 : 1));
            }

            const FDPS = FDmg / (FDur + (options && options.delay ? options.delay.ftime : 0));
            const CDPS = CDmg / (CDur + (options && options.delay ? options.delay.ctime : 0));

            const FEPS = FE / (FDur + (options && options.delay ? options.delay.ftime : 0));

            let CEPSM;
            let x = 0.5 * CE + 0.5 * FE;

            if (bar === 1) CEPSM = 0.5 * FE + 0.5 * y * CDWS;
            else CEPSM = 0;

            const CEPS = (CE + CEPSM) / (CDur + (options && options.delay ? options.delay.ctime : 0));

            if (options !== undefined && options.specific) {
                let λ;
                if (bar === 1) λ = 3;
                else if (bar === 2) λ = 1.5;
                else if (bar === 3) λ = 1;
                x = 0.5 * CE + 0.5 * FE + 0.5 * λ * options.FDmgenemy + options.CDmgenemy * λ + 1
            }

            const DPS0 = (FDPS * CEPS + CDPS * FEPS) / (CEPS + FEPS);

            let DPS;
            if (FDPS > CDPS) DPS = DPS0;
            else DPS = Math.max(0, DPS0 + ((CDPS - FDPS) / (CEPS + FEPS) * (DEFAULT_ENERYGY_PER_HP_LOST - (x / HP)) * y))
            return Math.max(FDPS, DPS);
        }

        function calculateTDO(Def, HP, dps, shadow) {
            let y;
            if (!shadow) {
                y = 900 / (Def * (DEFAULT_POKEMON_SHADOW ? 0.83333331 : 1));
            } else {
                y = 900 / (Def * (shadow ? 0.83333331 : 1));
            }
            return HP / y * dps
        }

        window.addEventListener('load', function () {
            loadPokemonNames();
            generateMoveOptions();

            new TomSelect("#pokemon-name", {
                create: false,
                sortField: {
                    field: "text",
                    direction: "asc"
                }
            });

            fetch("./pokemon_go/movesets.js")
                .then(response => response.json())
                .then(parsed_data => {
                    allMoveSet = parsed_data;
                });
            fetch("./pokemon_go/moves_pokemon_list.json")
                .then(response => response.json())
                .then(parsed_data => {
                    moves_Pokemon_List = parsed_data;
                });

            fetch("./pokemon_go/moves.json")
                .then(response => response.json())
                .then(parsed_data => {
                    newAllMoves = parsed_data;
                });

            fetch("./pokemon_go/pokemon.json")
                .then(response => response.json())
                .then(parsed_data => {
                    newPokemon = parsed_data;
                });

            fetch("./pokemon_go/cp_multiplier.json")
                .then(response => response.json())
                .then(parsed_data => {
                    data_cp_multiplier = parsed_data;
                });

            fetch("./pokemon_go/dps_table.json")
                .then(response => response.json())
                .then(parsed_data => {
                    dps_table = parsed_data;
                });
        })
    </script>
</body>

</html>